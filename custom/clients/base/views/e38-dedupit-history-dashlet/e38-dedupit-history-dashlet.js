({className:'list-view e38-dedupit-history-dashlet',plugins:['Dashlet'],loading:true,error_message:null,merged_duplicates:null,license_valid:false,events:{'click .e38-preview-merged-duplicate':'previewMergedDuplicate',},initialize:function(options){this._super('initialize',[options]);this.checkLicense();this.context.on('38elements:duplicates-merged',function(){this.loadData();}.bind(this),this);this.context.on('38elements:duplicates-merge-in-progress',function(){this.loading=true;this.render();}.bind(this),this);},loadData:function(options){this._super('loadData',[options]);if(!this.license_valid){return;}
if(!this.loading){this.loading=true;this.render();}
var module_name=this.model.get('_module');var record_id=this.model.get('id');app.api.call('GET',app.api.buildURL('E38_MergedDuplicates/get-merge-history/'+module_name+'/'+
record_id+''),null,{success:function(response){if(response.success){this.merged_duplicates=response.merged_duplicates;}else{this.error_message=response.message;}
this.loading=false;this.error_message=null;this.render();}.bind(this),error:function(error){this.loading=false;if(typeof error.message!='undefined'){this.error_message=error.message;this.render();}}.bind(this),});},previewMergedDuplicate:function(e){var preview_button=$(e.target).hasClass('fa')?$(e.target).parent():$(e.target);var merge_record_id=preview_button.attr('data-merged-duplicate-id');if(!merge_record_id){app.alert.show('no-duplicate-id',{level:'error',messages:app.lang.get('LBL_NO_DUPLICATE_ID','E38_FoundDuplicates'),autoClose:true,});return;}
app.alert.show('previewing-merged-duplicate',{level:'process'});app.api.call('GET',app.api.buildURL('E38_MergedDuplicates/preview-merged-record/'+merge_record_id+''),null,{success:function(response){if(response.success){var module=this.model.module||this.model.get('module');var duplicate_bean=app.data.createBean(module,response.duplicate_bean_attributes);var preview_collection=app.data.createBeanCollection(module,[duplicate_bean]);app.events.trigger('preview:render',duplicate_bean,preview_collection,false);app.events.trigger('preview:open',true);}else{app.alert.show('preview-failed',{level:'error',messages:response.message,});}}.bind(this),error:function(error){if(typeof error.message!='undefined'){this.error_message=error.message;this.render();}}.bind(this),complete:function(){app.alert.dismiss('previewing-merged-duplicate');},});},render:function(){this._super('render');try{var element_height=$('.e38-center-duplicate-rel').css('height');if(typeof element_height=='undefined'){return;}
element_height=$('.e38-center-duplicate-rel').css('height').slice(0,-2);var parent_height=$('.e38-center-duplicate-rel').parent().css('height').slice(0,-2);var margin=(parent_height-element_height)/ 2;if(isNaN(margin)||margin<0){return;}
$('.e38-center-duplicate-rel').css('margin-top',margin+'px');}catch(err){}},checkLicense:function(){app.api.call('read',app.api.buildURL('E38_DeDupit/check-license'),null,{success:function(response){if(response.success){this.license_valid=true;}else{this.loading=false;this.error_message=app.lang.get('LBL_E38_LICENSE_INVALID');this.render();}}.bind(this),error:function(error){if(error.status!==412){app.alert.show('server-error',{level:'error',messages:'ERR_GENERIC_SERVER_ERROR',});}
app.error.handleHttpError(error);}.bind(this),},{async:false});},});