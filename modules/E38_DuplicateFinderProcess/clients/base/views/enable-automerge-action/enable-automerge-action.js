({className:'duplicate-rules-action',extendsFrom:'BaseView',process_configuration_string:null,process_configuration:null,process_module:null,that:null,datetime_fields:[],rules_options:[],events:{'click a[name="cancel_button"]':'cancelEnablingAutomerge','click a[name="enable_automerge"]':'enableAutomerge',},initialize:function(options){var self=this;self.context=options.context;if(_.isUndefined(self.model)){self.model=options.context.get('model');}
self.that=options.context.get('this');if(self.model.get('id').length>0){self.process_module=self.model.get('for_module');self.process_configuration_string=self.model.get('rules_configuration');}
if(!_.isUndefined(self.process_configuration_string)&&self.process_configuration_string.length>0){self.process_configuration=JSON.parse(self.process_configuration_string);}
self.options.meta=_.extend({},app.metadata.getView(null,'duplicate-rules-action'),options.meta);self._super('initialize',[options]);self.buttons=self.options.meta.buttons;},loadData:function(options){var self=this;self._super('loadData',[options]);if(self.process_module==null){app.alert.show('no-model-set',{level:'error',messages:app.lang.get('NTF_NO_MODULE_SET','E38_DuplicateFinderProcess'),autoClose:false,});return;}
self.datetime_fields=[];self.rules_options=[];var rules_options=app.lang.getAppListStrings('e38_automerge_rules_options');var automerge_conf_string=self.model.get('automerge_configuration');var configuration=automerge_conf_string?JSON.parse(automerge_conf_string):[];$.each(rules_options,function(value,label){var selected=automerge_conf_string?configuration[0].rule==value?true:false:false;self.rules_options.push({value:value,label:label,selected:selected,});});var process_module_bean=app.data.createBean(self.process_module);$.each(process_module_bean.fields,function(field_name,field_data){if(field_data.type=='datetime'){var selected=automerge_conf_string?configuration[0].field==field_name?true:false:false;self.datetime_fields.push({label:app.lang.get(field_data.vname,self.process_module),id:field_data.name,selected:selected,});}});},enableAutomerge:function(){var self=this;if(self.process_configuration_string.length==0){app.alert.show('no-configuration',{level:'error',messages:app.lang.get('NTF_NO_CONFIGURATION','E38_DuplicateFinderProcess'),autoClose:false,});return;}
app.alert.show('saving-automerge-configuration',{level:'process',title:app.lang.get('LBL_CONFIGURATION_IS_BEING_SAVED','E38_DuplicateFinderProcess'),});var datetime_field=$('#e38_available_datetime_fields').val();var rule=$('#e38_available_rules_options').val();var automerge_configuration=[{field:datetime_field,rule:rule,}];self.model.set('automerge_configuration',JSON.stringify(automerge_configuration));self.model.set('automerge','yes');self.model.save({},{success:function(process_bean){app.alert.dismiss('saving-automerge-configuration');app.alert.show('automerge-configuration-saved',{level:'success',messages:app.lang.get('NTF_AUTOMERGE_CONFIGURATION_SAVED','E38_DuplicateFinderProcess'),autoClose:true,});app.drawer.close(process_bean,self.that);},error:function(error){app.alert.dismissAll();app.alert.show('server-error',{level:'error',messages:'ERR_GENERIC_SERVER_ERROR',autoClose:false,});app.error.handleHttpError(error);},});},cancelEnablingAutomerge:function(){app.alert.dismissAll();app.drawer.close();},});